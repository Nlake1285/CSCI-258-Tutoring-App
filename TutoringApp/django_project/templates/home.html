<!-- templates/home.html -->
{% extends "base.html" %}

{% block title %}Home{% endblock title %}

{% block content %}
{% if user.is_authenticated %}
<p>Hi {{ user.username }}! You are {{ user.age }} years old.</p>
<div class="mb-3">
    <a href="{% url 'post_new' %}" class="btn btn-primary">+ Add New Post</a>
    {% if user.is_tutor %}
    <a href="{% url 'hours_new' %}" class="btn btn-success">+ Add Tutoring Hours</a>
    <a href="{% url 'tutor_detail' user.pk %}" class="btn btn-info">My Profile</a>
    {% endif %}
</div>
<form action="{% url 'logout' %}" method="post">
    {% csrf_token %}
    <button type="submit" class="btn btn-outline-secondary">Log Out</button>
</form>
{% else %}
<p>You are not logged in</p>
<a href="{% url 'login' %}" class="btn btn-primary">Log In</a>
<a href="{% url 'signup' %}" class="btn btn-secondary">Sign Up</a>
{% endif %}

<h2 class="mt-4">CS Fishbowl Tutoring Hours</h2>

{% if tutoring_hours %}
<div class="table-responsive mb-4">
    <table class="table table-striped">
        <thead class="table-dark">
            <tr>
                <th>Tutor</th>
                <th>Day</th>
                <th>Time</th>
                <th>Location</th>
                <th>Classes Available</th>
            </tr>
        </thead>
        <tbody>
            {% for hour in tutoring_hours %}
            <tr>
                <td>
                    <a href="{% url 'tutor_detail' hour.tutor.pk %}" class="text-decoration-none">
                        <strong>{{ hour.tutor.get_full_name|default:hour.tutor.username }}</strong>
                    </a>
                </td>
                <td>{{ hour.get_day_of_week_display }}</td>
                <td>{{ hour.start_time|time:"g:i A" }} - {{ hour.end_time|time:"g:i A" }}</td>
                <td>{{ hour.location }}</td>
                <td>{{ hour.tutor.classes_can_tutor|default:"Not specified" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">
    <p>No tutoring hours scheduled yet.</p>
</div>
{% endif %}
{% if posts %}
    <h3>Recent Posts</h3>
    {% for post in posts %}
    <div class="post-entry mb-4 p-3 border rounded">
        <h4><a href="{{ post.get_absolute_url }}" class="text-decoration-none">{{ post.title }}</a></h4>
        <p class="text-muted mb-2"><small>By {{ post.author }}</small></p>
        <p>{{ post.body|truncatewords:30 }}</p>
        <a href="{{ post.get_absolute_url }}" class="btn btn-sm btn-outline-primary">Read More</a>
    </div>
    {% endfor %}
{% else %}
    <div class="alert alert-info">
        <h4>Welcome to the Tutoring App!</h4>
        <p>No posts yet. {% if user.is_authenticated %}<a href="{% url 'post_new' %}">Be the first to add one!</a>{% else %}<a href="{% url 'login' %}">Login</a> to add the first post!{% endif %}</p>
    </div>
{% endif %}
{% endblock content %}